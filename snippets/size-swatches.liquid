{%- assign size_type = section.settings.size_type | default: settings.size_type -%}
{%- unless product.options.size == 1 and product.variants[0].title == 'Default Title' -%}
{% capture size_swatch %}
    {%- for option in product.options_with_values -%}
       {%- liquid
          assign option_index = option.position | minus: 1
          assign is_size = false
          assign size_option_names = 'size,sizes,Size,Sizes,SIZE,SIZES' | split: ','
          if size_option_names contains option.name
            assign is_size = true
          endif
       %}
        {%- if is_size -%}
          <ul class="grssizes fl f-wrap f-aic{% if source != "list" %} f-jcc{% else %} mb20{% endif %}">
            {%- liquid
                assign variants_available_arr = product.variants | map: 'available'
                assign variants_option_1_arr = product.variants | map: 'option1'
                assign variants_option_2_arr = product.variants | map: 'option2'
                assign variants_option_3_arr = product.variants | map: 'option3'
              -%}
              {%- for value in option.values -%}
                {%- liquid
                  assign sz_count = forloop.index
                  assign option_disabled = true

                  for option1_name in variants_option_1_arr
                    case option.position
                      when 1
                        if variants_option_1_arr[forloop.index0] == value and variants_available_arr[forloop.index0]
                          assign option_disabled = false
                        endif
                      when 2
                        if option1_name == product.selected_or_first_available_variant.option1 and variants_option_2_arr[forloop.index0] == value and variants_available_arr[forloop.index0]
                          assign option_disabled = false
                        endif
                      when 3
                        if option1_name == product.selected_or_first_available_variant.option1 and variants_option_2_arr[forloop.index0] == product.selected_or_first_available_variant.option2 and variants_option_3_arr[forloop.index0] == value and variants_available_arr[forloop.index0]
                          assign option_disabled = false
                        endif
                    endcase
                  endfor

                  assign option_index = option.position | minus: 1
                  for variant in product.variants
                      if variant.options[option_index] == value
                        assign vr_img = variant.image
                        break
                      endif
                  endfor
                -%}
                <li class="swatch sizswt sz{{ value | handle }}{% if option_disabled %} disabled{% endif %}{% if sz_count > settings.szcount %} hide{% endif %}" 
                    title="{{ value }}" data-value="{{ value }}"{% if vr_img != null %} data-src="{{ vr_img | image_url: width: '400x' }}"{% endif %}>
                    <span class="size-label">{{ value }}</span>
                    <span class="tooltip-label top">{{ value }}</span>
                </li>
              {%- endfor -%}
              {%- if sz_count > settings.szcount -%}
                  <li class="numb szcount">{{ option.values.size | minus: settings.szcount }}+</li>
              {%- endif -%}
            </ul>
        {%- endif -%}
    {% endfor %}
{% endcapture %}
{{ size_swatch | strip_newlines | remove: "  " | remove: "	" }}
{%- endunless -%}