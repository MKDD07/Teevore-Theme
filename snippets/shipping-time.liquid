<!-- snippets/delivery-estimator.liquid -->

<div class="delivery-estimator box wd100">
  <h3 class="kug">Check Delivery Time</h3>
  <div class="fl f-row jcc gap10">
    <input type="text" id="pincode-input" placeholder="Enter Pincode (6 digits)" maxlength="6" class="wd70" style="max-height:45px; margin-bottom:0">
    <button class="btn btn7 btn-sm wd30" id="check-delivery-btn" onclick="checkDelivery()" type="button" style="max-height:45px;">
      <span class="btn-text">Check</span>
      <span class="btn-loader"></span>
    </button>
  </div>
  <div class="result" id="delivery-result"></div>
  <p class="mt10">{{ block.settings.paragraph_time }}</p>
</div>

<style>
  .delivery-estimator.box {
    font-family: inherit;
    position: relative;
  }
  
  .delivery-estimator h3 {
    margin: 0 0 15px 0;
    color: #333;
    font-size: 18px;
  }
  
  .delivery-estimator input {
    width: 100%;
    padding: 12px;
    border-radius: 6px;
    box-sizing: border-box;
    transition: border-color 0.3s ease;
  }
  
  .delivery-estimator input:focus {
    outline: none;
  }
  
  .delivery-estimator input.error {
    background: #fff5f5;
  }
  
  .delivery-estimator button:hover:not(.loading) {
  }
  
  .delivery-estimator button.loading {
    background: #999;
    cursor: not-allowed;
  }
  
  .delivery-estimator .btn-text {
    transition: opacity 0.3s ease;
  }
  
  .delivery-estimator button.loading .btn-text {
    opacity: 0;
  }
  
.delivery-estimator .btn-loader {
    position: absolute;
    top: 30%;
    left: 40%;
    transform: translate(-50%, -50%);
    border: 3px solid transparent;
    border-top: 3px solid #fff;
    border-radius: 50%;
    width: 20px;
    height: 20px;
    animation: spin 1s linear infinite;
    opacity: 0;
    transition: opacity 0.3s ease;
}

  
  .delivery-estimator button.loading .btn-loader {
    opacity: 1;
  }
  
  .delivery-estimator .result {
    margin-top: 15px;
    font-weight: bold;
    line-height: 1.4;
    /* Remove min-height to prevent empty space */
    display: none; /* Hidden by default */
  }
  
  .delivery-estimator .result.active {
    display: block; /* Show only when active */
  }
  
  .result.success {
    color: #006600;
  }
  
  .result.error {
    color: #ff4444;
  }
  
  @keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }

  /* Mobile responsiveness */
  @media (max-width: 480px) {
    .delivery-estimator.box {
      max-width: 100%;
      margin: 0;
    }
  }
</style>

<script>
  document.addEventListener("DOMContentLoaded", function() {
    const pincodeMap = {
      "11": { minDays: 2, maxDays: 3 },
      "12": { minDays: 2, maxDays: 3 },
      "13": { minDays: 3, maxDays: 4 },
      "14": { minDays: 3, maxDays: 4 },
      "15": { minDays: 2, maxDays: 3 },
      "16": { minDays: 3, maxDays: 4 },
      "17": { minDays: 4, maxDays: 5 },
      "18": { minDays: 3, maxDays: 4 },
      "19": { minDays: 3, maxDays: 4 },
      "20": { minDays: 3, maxDays: 4 },
      "21": { minDays: 3, maxDays: 4 },
      "22": { minDays: 3, maxDays: 4 },
      "23": { minDays: 3, maxDays: 4 },
      "24": { minDays: 3, maxDays: 4 },
      "25": { minDays: 3, maxDays: 4 },
      "26": { minDays: 4, maxDays: 5 },
      "27": { minDays: 4, maxDays: 5 },
      "28": { minDays: 4, maxDays: 5 },
      "30": { minDays: 3, maxDays: 4 },
      "31": { minDays: 3, maxDays: 4 },
      "32": { minDays: 3, maxDays: 4 },
      "33": { minDays: 3, maxDays: 4 },
      "34": { minDays: 4, maxDays: 5 },
      "36": { minDays: 4, maxDays: 5 },
      "37": { minDays: 4, maxDays: 5 },
      "38": { minDays: 4, maxDays: 5 },
      "39": { minDays: 4, maxDays: 5 },
      "40": { minDays: 5, maxDays: 6 },
      "41": { minDays: 5, maxDays: 6 },
      "42": { minDays: 5, maxDays: 6 },
      "43": { minDays: 5, maxDays: 6 },
      "44": { minDays: 5, maxDays: 6 },
      "45": { minDays: 5, maxDays: 6 },
      "46": { minDays: 4, maxDays: 5 },
      "47": { minDays: 4, maxDays: 5 },
      "48": { minDays: 4, maxDays: 5 },
      "49": { minDays: 5, maxDays: 6 },
      "50": { minDays: 5, maxDays: 6 },
      "51": { minDays: 5, maxDays: 6 },
      "52": { minDays: 5, maxDays: 6 },
      "53": { minDays: 5, maxDays: 6 },
      "56": { minDays: 5, maxDays: 6 },
      "57": { minDays: 5, maxDays: 6 },
      "58": { minDays: 5, maxDays: 6 },
      "59": { minDays: 5, maxDays: 6 },
      "60": { minDays: 6, maxDays: 7 },
      "61": { minDays: 6, maxDays: 7 },
      "62": { minDays: 6, maxDays: 7 },
      "63": { minDays: 6, maxDays: 7 },
      "64": { minDays: 6, maxDays: 7 },
      "67": { minDays: 6, maxDays: 7 },
      "68": { minDays: 6, maxDays: 7 },
      "69": { minDays: 6, maxDays: 7 },
      "70": { minDays: 5, maxDays: 6 },
      "71": { minDays: 5, maxDays: 6 },
      "72": { minDays: 5, maxDays: 6 },
      "73": { minDays: 5, maxDays: 6 },
      "74": { minDays: 5, maxDays: 6 },
      "75": { minDays: 5, maxDays: 6 },
      "76": { minDays: 5, maxDays: 6 },
      "77": { minDays: 5, maxDays: 6 },
      "78": { minDays: 7, maxDays: 8 },
      "79": { minDays: 7, maxDays: 8 },
      "80": { minDays: 4, maxDays: 5 },
      "81": { minDays: 4, maxDays: 5 },
      "82": { minDays: 4, maxDays: 5 },
      "83": { minDays: 4, maxDays: 5 },
      "84": { minDays: 4, maxDays: 5 },
      "85": { minDays: 4, maxDays: 5 }
    };

    const input = document.getElementById("pincode-input");
    const button = document.getElementById("check-delivery-btn");
    const resultBox = document.getElementById("delivery-result");

    // Function to calculate future date
    function addDaysToDate(days) {
      const date = new Date();
      date.setDate(date.getDate() + days);
      return date.toLocaleDateString('en-IN', { 
        weekday: 'short',
        day: 'numeric',
        month: 'short'
      });
    }

    // Function to skip weekends for business days calculation
    function addBusinessDays(days) {
      const date = new Date();
      let addedDays = 0;
      
      while (addedDays < days) {
        date.setDate(date.getDate() + 1);
        // Skip weekends (0 = Sunday, 6 = Saturday)
        if (date.getDay() !== 0 && date.getDay() !== 6) {
          addedDays++;
        }
      }
      
      return date.toLocaleDateString('en-IN', { 
        weekday: 'short',
        day: 'numeric',
        month: 'short'
      });
    }

    // Allow only numbers in input
    input.addEventListener("input", function(e) {
      e.target.value = e.target.value.replace(/[^0-9]/g, '');
      // Remove error styling and hide result when user starts typing
      if (e.target.classList.contains('error')) {
        e.target.classList.remove('error');
        resultBox.className = 'result';
        resultBox.innerHTML = '';
      }
    });

    // Allow Enter key to trigger check
    input.addEventListener("keypress", function(e) {
      if (e.key === "Enter" && !button.classList.contains('loading')) {
        checkDelivery();
      }
    });

    window.checkDelivery = function() {
      const pincode = input.value.trim();
      
      // Prevent multiple clicks during loading
      if (button.classList.contains('loading')) {
        return;
      }
      
      // Clear previous results and styling
      resultBox.innerHTML = "";
      resultBox.className = 'result';
      input.classList.remove('error');
      
      // Validate: must be 6 digits only
      if (!/^[0-9]{6}$/.test(pincode)) {
        input.classList.add('error');
        resultBox.className = 'result error active';
        resultBox.innerHTML = "âŒ Please enter a valid 6-digit pincode";
        return;
      }

      // Add loading state to button
      button.classList.add('loading');

      // Simulate API delay (2-4 seconds)
      const delay = Math.floor(Math.random() * 2000) + 2000;
      
      setTimeout(() => {
        // Remove loading state
        button.classList.remove('loading');
        
        const prefix = pincode.substring(0, 2);

        if (pincodeMap[prefix]) {
          const { minDays, maxDays } = pincodeMap[prefix];
          
          // Calculate delivery dates (using business days)
          const minDate = addBusinessDays(minDays);
          const maxDate = addBusinessDays(maxDays);
          
          resultBox.className = 'result success active';
          
          // Show date range if different dates, otherwise show single date
          if (minDate === maxDate) {
            resultBox.innerHTML = `
              <div style="display: flex; align-items: center; gap: 8px;">
                <span><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="https://www.w3.org/2000/svg">
<path d="M21.501 15.5C21.781 15.5 22.001 15.72 22.001 16V17C22.001 18.66 20.661 20 19.001 20C19.001 18.35 17.651 17 16.001 17C14.351 17 13.001 18.35 13.001 20H11.001C11.001 18.35 9.65098 17 8.00098 17C6.35098 17 5.00098 18.35 5.00098 20C3.34098 20 2.00098 18.66 2.00098 17V15C2.00098 14.45 2.45098 14 3.00098 14H12.501C13.881 14 15.001 12.88 15.001 11.5V6C15.001 5.45 15.451 5 16.001 5H16.841C17.561 5 18.221 5.39 18.581 6.01L19.221 7.13C19.311 7.29 19.191 7.5 19.001 7.5C17.621 7.5 16.501 8.62 16.501 10V13C16.501 14.38 17.621 15.5 19.001 15.5H21.501Z" fill="#4F772D"/>
<path d="M8.00098 22C9.10555 22 10.001 21.1046 10.001 20C10.001 18.8954 9.10555 18 8.00098 18C6.89641 18 6.00098 18.8954 6.00098 20C6.00098 21.1046 6.89641 22 8.00098 22Z" fill="#4F772D"/>
<path d="M16.001 22C17.1055 22 18.001 21.1046 18.001 20C18.001 18.8954 17.1055 18 16.001 18C14.8964 18 14.001 18.8954 14.001 20C14.001 21.1046 14.8964 22 16.001 22Z" fill="#4F772D"/>
<path d="M22.001 12.53V14H19.001C18.451 14 18.001 13.55 18.001 13V10C18.001 9.45 18.451 9 19.001 9H20.291L21.741 11.54C21.911 11.84 22.001 12.18 22.001 12.53Z" fill="#4F772D"/>
<path d="M13.081 2H5.69098C3.90098 2 2.40098 3.28 2.07098 4.98H6.44098C6.82098 4.98 7.12098 5.29 7.12098 5.67C7.12098 6.05 6.82098 6.35 6.44098 6.35H2.00098V7.73H4.60098C4.98098 7.73 5.29098 8.04 5.29098 8.42C5.29098 8.8 4.98098 9.1 4.60098 9.1H2.00098V10.48H2.77098C3.15098 10.48 3.46098 10.79 3.46098 11.17C3.46098 11.55 3.15098 11.85 2.77098 11.85H2.00098V12.08C2.00098 12.63 2.45098 13.08 3.00098 13.08H12.151C13.171 13.08 14.001 12.25 14.001 11.23V2.92C14.001 2.41 13.591 2 13.081 2Z" fill="#4F772D"/>
<path d="M2.07098 4.97998H1.92098H0.940977C0.560977 4.97998 0.250977 5.28998 0.250977 5.66998C0.250977 6.04998 0.560977 6.34998 0.940977 6.34998H1.85098H2.00098V5.68998C2.00098 5.44998 2.03098 5.20998 2.07098 4.97998Z" fill="#4F772D"/>
<path d="M1.85098 7.72998H0.940977C0.560977 7.72998 0.250977 8.03998 0.250977 8.41998C0.250977 8.79998 0.560977 9.09998 0.940977 9.09998H1.85098H2.00098V7.72998H1.85098Z" fill="#4F772D"/>
<path d="M1.85098 10.48H0.940977C0.560977 10.48 0.250977 10.79 0.250977 11.17C0.250977 11.55 0.560977 11.85 0.940977 11.85H1.85098H2.00098V10.48H1.85098Z" fill="#4F772D"/>
</svg>
</span>
                <div style="font-weight: bold; color:#222222">
                  Expected Delivery: <span style="color: #4f772d; font-weight: bold;">${minDate}
                </div>
              </div>
            `;
          } else {
            resultBox.innerHTML = `
              <div style="display: flex; align-items: center; gap: 8px;">
                <span><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="https://www.w3.org/2000/svg">
<path d="M21.501 15.5C21.781 15.5 22.001 15.72 22.001 16V17C22.001 18.66 20.661 20 19.001 20C19.001 18.35 17.651 17 16.001 17C14.351 17 13.001 18.35 13.001 20H11.001C11.001 18.35 9.65098 17 8.00098 17C6.35098 17 5.00098 18.35 5.00098 20C3.34098 20 2.00098 18.66 2.00098 17V15C2.00098 14.45 2.45098 14 3.00098 14H12.501C13.881 14 15.001 12.88 15.001 11.5V6C15.001 5.45 15.451 5 16.001 5H16.841C17.561 5 18.221 5.39 18.581 6.01L19.221 7.13C19.311 7.29 19.191 7.5 19.001 7.5C17.621 7.5 16.501 8.62 16.501 10V13C16.501 14.38 17.621 15.5 19.001 15.5H21.501Z" fill="#4F772D"/>
<path d="M8.00098 22C9.10555 22 10.001 21.1046 10.001 20C10.001 18.8954 9.10555 18 8.00098 18C6.89641 18 6.00098 18.8954 6.00098 20C6.00098 21.1046 6.89641 22 8.00098 22Z" fill="#4F772D"/>
<path d="M16.001 22C17.1055 22 18.001 21.1046 18.001 20C18.001 18.8954 17.1055 18 16.001 18C14.8964 18 14.001 18.8954 14.001 20C14.001 21.1046 14.8964 22 16.001 22Z" fill="#4F772D"/>
<path d="M22.001 12.53V14H19.001C18.451 14 18.001 13.55 18.001 13V10C18.001 9.45 18.451 9 19.001 9H20.291L21.741 11.54C21.911 11.84 22.001 12.18 22.001 12.53Z" fill="#4F772D"/>
<path d="M13.081 2H5.69098C3.90098 2 2.40098 3.28 2.07098 4.98H6.44098C6.82098 4.98 7.12098 5.29 7.12098 5.67C7.12098 6.05 6.82098 6.35 6.44098 6.35H2.00098V7.73H4.60098C4.98098 7.73 5.29098 8.04 5.29098 8.42C5.29098 8.8 4.98098 9.1 4.60098 9.1H2.00098V10.48H2.77098C3.15098 10.48 3.46098 10.79 3.46098 11.17C3.46098 11.55 3.15098 11.85 2.77098 11.85H2.00098V12.08C2.00098 12.63 2.45098 13.08 3.00098 13.08H12.151C13.171 13.08 14.001 12.25 14.001 11.23V2.92C14.001 2.41 13.591 2 13.081 2Z" fill="#4F772D"/>
<path d="M2.07098 4.97998H1.92098H0.940977C0.560977 4.97998 0.250977 5.28998 0.250977 5.66998C0.250977 6.04998 0.560977 6.34998 0.940977 6.34998H1.85098H2.00098V5.68998C2.00098 5.44998 2.03098 5.20998 2.07098 4.97998Z" fill="#4F772D"/>
<path d="M1.85098 7.72998H0.940977C0.560977 7.72998 0.250977 8.03998 0.250977 8.41998C0.250977 8.79998 0.560977 9.09998 0.940977 9.09998H1.85098H2.00098V7.72998H1.85098Z" fill="#4F772D"/>
<path d="M1.85098 10.48H0.940977C0.560977 10.48 0.250977 10.79 0.250977 11.17C0.250977 11.55 0.560977 11.85 0.940977 11.85H1.85098H2.00098V10.48H1.85098Z" fill="#4F772D"/>
</svg>
</span>
                <div style="font-weight: bold;color:#222222">
                  Expected Delivery: <span style="color: #4f772d; font-weight: bold;">${minDate} - ${maxDate}</span>
                </div>
              </div>
            `;
          }
        } else {
          resultBox.className = 'result error active';
          resultBox.innerHTML = "Sorry, delivery not available to this pincode";
        }
      }, delay);
    }
  });
</script>