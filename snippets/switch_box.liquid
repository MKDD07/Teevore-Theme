{% if section.settings.target_collection %}
  {% assign collection_url = '/collections/' | append: section.settings.target_collection.handle %}
  {% assign home_url = '/' %}
  {% assign current_page = request.path %}

  <!-- Page transition overlay -->
  <div id="pageTransition" class="page-transition"></div>

  <div class="page-switch">
    <div class="switch-container {% if request.path contains '/collections/women' or template contains 'girls_collections' %}collection-active{% endif %}">
      <!-- MEN -->
      <a href="{{ home_url }}" class="switch-option {% unless request.path contains '/collections/women' or template contains 'girls_collections' %}active{% endunless %}" onclick="return handlePageSwitch(this, '{{ home_url }}')">
                <span class="hide-lg">
<svg width="9" height="24" viewBox="0 0 9 24" fill="none" xmlns="https://www.w3.org/2000/svg">
<path fill-rule="evenodd" clip-rule="evenodd" d="M6.95401 7.60352V22.8828C6.9535 23.1786 6.83651 23.4622 6.62861 23.6715C6.42071 23.8809 6.13882 23.999 5.84455 24C5.54995 23.9995 5.26756 23.8816 5.05924 23.6722C4.85093 23.4628 4.73367 23.179 4.73316 22.8828V13.8984H4.29598V22.8828C4.29496 23.1788 4.17753 23.4624 3.96933 23.6716C3.76112 23.8809 3.47903 23.999 3.18458 24C2.89014 23.999 2.60804 23.8809 2.39984 23.6716C2.19163 23.4624 2.07421 23.1788 2.07318 22.8828V7.60352H1.68458V13.2188C1.68356 13.4425 1.59453 13.6569 1.43692 13.8149C1.27931 13.973 1.0659 14.062 0.843263 14.0625C0.620444 14.062 0.406838 13.9731 0.248917 13.815C0.0909958 13.657 0.00153611 13.4427 0 13.2188L0 7.17578C0 6.19922 0.328368 5.50391 0.926813 5.05078C1.9566 4.26953 7.0395 4.26953 8.06929 5.05078C8.66968 5.50391 9.00193 6.19336 8.99999 7.17578V13.2188C8.99846 13.4421 8.90954 13.6558 8.75246 13.8137C8.59537 13.9716 8.38276 14.061 8.16061 14.0625C7.93746 14.062 7.72356 13.9728 7.56559 13.8143C7.40761 13.6559 7.31838 13.4411 7.31735 13.2168V7.60352H6.95401ZM4.5 0C4.89735 0 5.28578 0.118443 5.61617 0.340352C5.94656 0.562261 6.20407 0.877669 6.35613 1.24669C6.50819 1.61571 6.54798 2.02177 6.47046 2.41352C6.39294 2.80527 6.20159 3.16512 5.92062 3.44756C5.63965 3.72999 5.28167 3.92233 4.89195 4.00026C4.50222 4.07818 4.09827 4.03819 3.73116 3.88533C3.36405 3.73248 3.05028 3.47363 2.82952 3.14152C2.60876 2.80941 2.49093 2.41896 2.49093 2.01953C2.49093 1.48392 2.7026 0.970243 3.07937 0.591507C3.45614 0.212771 3.96716 0 4.5 0Z" fill="currentColor" style="fill:"currentColor";fill-opacity:1;"/>
</svg>

      </span>
        <span class="hide-sm hide-md">MEN</span>
      </a>

      <!-- WOMEN -->
      <a href="{{ collection_url }}" class="switch-option {% if request.path contains '/collections/women' or template contains 'girls_collections' %}active{% endif %}" onclick="return handlePageSwitch(this, '{{ collection_url }}')">
        <span class="hide-lg">
          <svg width="13" height="24" viewBox="0 0 13 24" fill="none" xmlns="https://www.w3.org/2000/svg">
<path d="M11.1444 7.04689C11.1349 7.01067 11.1221 6.97537 11.106 6.94142L11.112 6.94532C10.8837 6.03126 10.7827 5.47267 10.207 5.0547C9.13623 4.27345 3.96238 4.27345 2.89164 5.0547C2.26941 5.50782 2.04314 6.20314 1.77243 7.1797H1.79061L0.0228935 13.2578C-0.0289219 13.4755 0.00797236 13.7042 0.125919 13.8963C0.243865 14.0884 0.433805 14.2293 0.656312 14.2896C0.87882 14.3499 1.11681 14.325 1.32087 14.2202C1.52494 14.1154 1.67941 13.9386 1.75223 13.7266L3.53206 7.61134H3.56641H3.97046V7.75782L1.45121 17.1328H3.97248V22.8828C3.97301 23.1786 4.09465 23.4622 4.31081 23.6715C4.52697 23.8809 4.82007 23.999 5.12604 24C5.43235 23.9995 5.72597 23.8816 5.94257 23.6722C6.15917 23.4628 6.28109 23.179 6.28162 22.8828V17.1328H6.73618V22.8789C6.73671 23.175 6.85863 23.4589 7.07523 23.6683C7.29183 23.8777 7.58544 23.9956 7.89176 23.9961C8.19791 23.9951 8.49122 23.877 8.7077 23.6677C8.92418 23.4585 9.04627 23.1749 9.04734 22.8789V17.1289H11.4232L9.04734 7.98829V7.59767H9.41907H9.44533L11.2393 13.7266C11.3036 13.948 11.4563 14.1357 11.6637 14.2483C11.7664 14.3041 11.8795 14.3398 11.9964 14.3533C12.1134 14.3668 12.232 14.3579 12.3454 14.3272C12.4588 14.2964 12.5648 14.2443 12.6574 14.1739C12.75 14.1035 12.8274 14.0162 12.8851 13.9169C12.9428 13.8176 12.9797 13.7083 12.9937 13.5952C13.0076 13.4821 12.9985 13.3675 12.9666 13.2578L11.1444 7.04689Z" fill="currentColor" style="fill:"currentColor";fill-opacity:1;"/>
<path d="M7.66017 0.344159C7.31771 0.121313 6.91463 0.00155899 6.50183 1.51126e-05C6.22683 -0.00101339 5.95432 0.0504643 5.69994 0.151495C5.44557 0.252525 5.21433 0.401119 5.0195 0.588753C4.82467 0.776386 4.67007 0.999364 4.56459 1.2449C4.45911 1.49043 4.40481 1.75368 4.40481 2.01955C4.40481 2.41864 4.52713 2.80878 4.75631 3.14072C4.98549 3.47266 5.31126 3.73151 5.69249 3.88459C6.07372 4.03767 6.49332 4.07812 6.89831 4.00082C7.30331 3.92353 7.67553 3.73196 7.96799 3.45031C8.26046 3.16865 8.46004 2.80954 8.54155 2.4183C8.62307 2.02707 8.58285 1.62126 8.42598 1.2521C8.26911 0.882948 8.00263 0.567004 7.66017 0.344159Z" fill="currentColor" style="fill:"currentColor";fill-opacity:1;"/>
</svg>

          </span><span class="hide-sm hide-md">WOMEN</span>
      </a>
    </div>
  </div>

  <script>
    function handlePageSwitch(element, targetUrl) {
      if (window.location.pathname === targetUrl) return false;

      const container = element.closest('.switch-container');
      const transition = document.getElementById('pageTransition');

      element.classList.add('loading');

      // Update active slide
      if (targetUrl === '{{ home_url }}') {
        container.classList.remove('collection-active');
      } else {
        container.classList.add('collection-active');
      }

      // Show overlay
      transition.classList.add('active');

      setTimeout(() => {
        window.location.href = targetUrl;
      }, 500);

      return false;
    }
  </script>

  <style>
    .page-switch { display: flex; justify-content: center; width: 240px; padding-bottom: 15px; }
    .switch-container { display: flex; background: #fafafa; border-radius: 15px; padding: 4px; position: relative; overflow: hidden; width: 100%; }
    .switch-container::before {
      content: '';
      position: absolute;
      top: 4px; left: 4px;
      width: calc(50% - 4px);
      height: calc(100% - 8px);
      background: {% unless request.path contains '/collections/women' or template contains 'girls_collections' %}{{ settings.bgs }}{% else %}{{ settings.bgl }}{% endunless %};
      border-radius: 15px;
      transition: transform 0.5s ease;
      z-index: 1;
    }
    .switch-container.collection-active::before { transform: translateX(100%); }

    .switch-option {
      flex: 1;
      text-align: center;
      padding: 8px 16px;
      text-decoration: none;
      color: #666;
      position: relative;
      z-index: 2;
      border-radius: 21px;
      cursor: pointer;
      transition: all 0.3s ease;
      font-weight: 500;
    }

    .switch-option.active { color: #fff; text-shadow: 0 1px 2px rgba(0,0,0,0.2); }
    .switch-option:hover { color: #333; text-decoration: none; }
    .switch-option.active:hover { color: white; }

    .switch-option.loading { color: transparent !important; position: relative; }
    .switch-option.loading::after {
      content: '';
      position: absolute; top: 50%; left: 50%;
      width: 16px; height: 16px; margin: -8px 0 0 -8px;
      border: 2px solid #fff; border-top: 2px solid transparent; border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }

    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

    .page-transition {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: linear-gradient(45deg,#2196F3,#1976D2);
      z-index: 9999; opacity: 0; visibility: hidden;
      display: flex; align-items: center; justify-content: center; transition: all 0.5s ease;
      color: white; font-size: 1.2em; font-weight: 500;
    }
    .page-transition.active { opacity: 1; visibility: visible; }
    .page-transition::before {
      content: ''; width: 40px; height: 40px; border: 3px solid rgba(255,255,255,0.3);
      border-top: 3px solid white; border-radius: 50%; animation: spin 1s linear infinite;
    }

    body { animation: fadeIn 0.5s ease-in-out; }
    @keyframes fadeIn { 0% { opacity: 0; } 100% { opacity: 1; } }
    @media (max-width: 576px)
    {
        .page-switch {width: 120px;}
      }
  </style>
{% endif %}
