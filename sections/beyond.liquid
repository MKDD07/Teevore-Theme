{% comment %}
Hero Image Text Slider Section
{% endcomment %}

{%- liquid
  assign section_id = 'hero-slider-' | append: section.id
  assign unique_id = section.id
  assign section_st = section.settings
-%}

<section class="hero-slider kug" id="{{ section_id }}">
  <div class="text-slider-wrapper">
    <div class="text-slider" id="text-slider-{{ unique_id }}">
      {%- for block in section.blocks -%}
        {%- case block.type -%}
          {%- when 'text_slide' -%}
            <div class="text-slide" {{ block.shopify_attributes }}>
              <h2 class="fw-sec slide-heading kug">{{ block.settings.heading | newline_to_br }}</h2>
            </div>
        {%- endcase -%}
      {%- endfor -%}
    </div>
  </div>

  <div class="blocks">
    <div class="block-1"></div>
    <div class="block-2"></div>
    <div class="block-3"></div>
  </div>

  <div class="overlay"></div>

  <div class="image-slider" id="image-slider-{{ unique_id }}">
    {%- for block in section.blocks -%}
      {%- case block.type -%}
        {%- when 'image_slide' -%}
          <div class="image-slide" {{ block.shopify_attributes }}>
{%- if block.settings.image -%}
  {{
    block.settings.image | image_url: width: 1920 | image_tag:
      loading: 'lazy',
      widths: '375, 550, 750, 1100, 1500, 1780, 2000, 3000, 3840',
      alt: block.settings.heading,
      class: 'slide-image'
  }}
{%- else -%}
  <div class="placeholder-image">
    {{ 'lifestyle-1' | placeholder_svg_tag: 'placeholder-svg' }}
  </div>
{%- endif -%}
          </div>
      {%- endcase -%}
    {%- endfor -%}
  </div>
</section>

<style>
  #{{ section_id }} {
    position: relative;
    width: 100%;
    overflow: hidden;
    max-height:600px;
    background: {{ section_st.background_color }};
  }

  #{{ section_id }} .image-slider {
    z-index: 0;
    margin: 0 auto;
    padding: 0;
    width: 100%;
    height: 100%;
  }

  #{{ section_id }} .image-slide {
    height: 100%;
    margin: 0 auto;
    position: relative;
  }

  #{{ section_id }} img {
    width: 100%;
    height: 100%;
    object-fit: contain;
    object-position: center;
  }

  #{{ section_id }} .placeholder-image {
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    background: #f5f5f5;
  }

  #{{ section_id }} .placeholder-svg {
    width: 100px;
    height: 100px;
    opacity: 0.5;
  }

  #{{ section_id }} .slick-slide.slick-center {
    transform: scale({{ section_st.center_scale }});
    transition: transform .8s 1.4s cubic-bezier(.84, 0, .08, .99);
  }

  #{{ section_id }} .slick-slide {
    transition: transform .7s cubic-bezier(.84, 0, .08, .99);
  }

  #{{ section_id }} .block-1 {
    z-index: 1;
    position: absolute;
    height: 100%;
    width: 5%;
    left: 0;
    background: {{ section_st.background_color }};
  }

  #{{ section_id }} .block-2 {
    z-index: 1;
    position: absolute;
    height: 100%;
    width: 25%;
    left: 25%;
    background: {{ section_st.background_color }};
  }

  #{{ section_id }} .block-3 {
    z-index: 1;
    position: absolute;
    height: 100%;
    width: 5%;
    right: 0;
    background: {{ section_st.background_color }};
  }

  #{{ section_id }} .overlay {
    z-index: 1;
    position: absolute;
    height: 100%;
    width: 20%;
    left: 5%;
    background: rgba(0, 0, 0, {{ section_st.overlay_opacity | divided_by: 100.0 }});
  }

  #{{ section_id }} .text-slider-wrapper {
    z-index: 2;
    position: absolute;
    width: 100%;
    top: 30%;
  }

  #{{ section_id }} .text-slider {
    margin: 0;
    padding: 0;
    height: 100%;
  }

  #{{ section_id }} .slide-heading {
    color: {{ section_st.text_color }};
  }

  /* Hide default slick dots and arrows for this section only */
  #{{ section_id }} .slick-dots {
    display: none !important;
  }

  #{{ section_id }} .slick-prev, 
  #{{ section_id }} .slick-next {
    display: none !important;
  }

  @media(max-width: 990px) {
    #{{ section_id }} .block-2, 
    #{{ section_id }} .overlay {
      display: none;
    }

    #{{ section_id }} .block-1 {
      width: 0;
    }

    #{{ section_id }} .block-3 {
      width: 0;
    }

    #{{ section_id }} .slide-heading {
      font-size: {{ section_st.heading_size_mobile }}px !important;
    }

    #{{ section_id }} .text-slider-wrapper {
      position: absolute;
      top: 50% !important;
    }

    #{{ section_id }} {
      height: {{ section_st.section_height_mobile }}px;
    }
  }
</style>

<!-- Load dependencies only if not already loaded -->
<script>
  (function() {
    const sectionId = '{{ section.id }}';
    const uniqueNamespace = 'heroSlider_' + sectionId;
    
    // Prevent multiple initializations
    if (window[uniqueNamespace + '_initialized']) {
      return;
    }
    
    function loadScript(src, callback) {
      const script = document.createElement('script');
      script.src = src;
      script.onload = callback;
      script.onerror = function() {
        console.error('Failed to load script:', src);
      };
      document.head.appendChild(script);
    }
    
    function loadCSS(href) {
      if (!document.querySelector('link[href="' + href + '"]')) {
        const link = document.createElement('link');
        link.rel = 'stylesheet';
        link.href = href;
        document.head.appendChild(link);
      }
    }
    
    function initializeSlider() {
      if (typeof jQuery === 'undefined' || typeof jQuery.fn.slick === 'undefined') {
        console.error('jQuery or Slick not available for section {{ section.id }}');
        return;
      }
      
      const $ = jQuery.noConflict(true);
      const imageSlider = $('#image-slider-{{ unique_id }}');
      const textSlider = $('#text-slider-{{ unique_id }}');
      
      // Destroy existing slick instances if they exist
      if (imageSlider.hasClass('slick-initialized')) {
        imageSlider.slick('unslick');
      }
      if (textSlider.hasClass('slick-initialized')) {
        textSlider.slick('unslick');
      }
      
      if (imageSlider.length && textSlider.length) {
        const slickPrimary = {
          autoplay: {{ section_st.autoplay }},
          autoplaySpeed: {{ section_st.autoplay_speed }},
          slidesToShow: 2,
          slidesToScroll: 1,
          speed: {{ section_st.transition_speed }},
          cssEase: 'cubic-bezier(.84, 0, .08, .99)',
          asNavFor: '#text-slider-{{ unique_id }}',
          centerMode: true,
          arrows: false,
          dots: false,
          infinite: true,
          pauseOnHover: false,
          pauseOnFocus: false,
          responsive: [
            {
              breakpoint: 990,
              settings: {
                slidesToShow: 1
              }
            }
          ]
        };

        const slickSecondary = {
          autoplay: {{ section_st.autoplay }},
          autoplaySpeed: {{ section_st.autoplay_speed }},
          slidesToShow: 1,
          slidesToScroll: 1,
          speed: {{ section_st.transition_speed }},
          cssEase: 'cubic-bezier(.84, 0, .08, .99)',
          asNavFor: '#image-slider-{{ unique_id }}',
          arrows: false,
          dots: false,
          infinite: true,
          fade: true,
          pauseOnHover: false,
          pauseOnFocus: false
        };

        try {
          setTimeout(function() {
            imageSlider.slick(slickPrimary);
            textSlider.slick(slickSecondary);
            window[uniqueNamespace + '_initialized'] = true;
          }, 200);
        } catch (error) {
          console.error('Slick initialization failed for section {{ section.id }}:', error);
        }
      }
    }
    
    function checkAndInit() {
      if (typeof jQuery !== 'undefined' && typeof jQuery.fn.slick !== 'undefined') {
        initializeSlider();
      } else {
        // Load dependencies
        if (typeof jQuery === 'undefined') {
          loadScript('https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js', function() {
            loadDependencies();
          });
        } else {
          loadDependencies();
        }
      }
    }
    
    function loadDependencies() {
      // Load Slick CSS
      loadCSS('https://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.8.1/slick.min.css');
      loadCSS('https://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.8.1/slick-theme.min.css');
      
      // Load Slick JS
      if (typeof jQuery.fn.slick === 'undefined') {
        loadScript('https://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.8.1/slick.min.js', function() {
          setTimeout(initializeSlider, 100);
        });
      } else {
        initializeSlider();
      }
    }
    
    // Initialize when DOM is ready
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', checkAndInit);
    } else {
      checkAndInit();
    }
    
    // Cleanup on section unload (for theme editor)
    document.addEventListener('shopify:section:unload', function(event) {
      if (event.detail.sectionId === '{{ section.id }}') {
        const $ = jQuery;
        if ($ && $.fn.slick) {
          $('#image-slider-{{ unique_id }}').slick('unslick');
          $('#text-slider-{{ unique_id }}').slick('unslick');
        }
        window[uniqueNamespace + '_initialized'] = false;
      }
    });
    
    // Reinitialize on section reload (for theme editor)
    document.addEventListener('shopify:section:load', function(event) {
      if (event.detail.sectionId === '{{ section.id }}') {
        setTimeout(checkAndInit, 300);
      }
    });
  })();
</script>

{% schema %}
{
  "name": "Hero Image Text Slider",
  "tag": "section",
  "class": "hero-slider-section",
  "settings": [
    {
      "type": "range",
      "id": "section_height",
      "min": 400,
      "max": 800,
      "step": 50,
      "unit": "px",
      "label": "Section height (desktop)",
      "default": 600
    },
    {
      "type": "range",
      "id": "section_height_mobile",
      "min": 300,
      "max": 600,
      "step": 25,
      "unit": "px",
      "label": "Section height (mobile)",
      "default": 500
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Background color",
      "default": "#222222"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Text color",
      "default": "#ffffff"
    },
    {
      "type": "range",
      "id": "overlay_opacity",
      "min": 0,
      "max": 100,
      "step": 5,
      "unit": "%",
      "label": "Overlay opacity",
      "default": 65
    },
    {
      "type": "select",
      "id": "font_family",
      "label": "Font family",
      "default": "Inter",
      "options": [
        {
          "value": "Inter",
          "label": "Inter"
        },
        {
          "value": "Arial",
          "label": "Arial"
        },
        {
          "value": "Helvetica",
          "label": "Helvetica"
        },
        {
          "value": "Georgia",
          "label": "Georgia"
        }
      ]
    },
    {
      "type": "range",
      "id": "heading_size",
      "min": 24,
      "max": 80,
      "step": 2,
      "unit": "px",
      "label": "Heading size (desktop)",
      "default": 64
    },
    {
      "type": "range",
      "id": "heading_size_mobile",
      "min": 18,
      "max": 40,
      "step": 2,
      "unit": "px",
      "label": "Heading size (mobile)",
      "default": 30
    },
    {
      "type": "select",
      "id": "font_weight",
      "label": "Font weight",
      "default": "400",
      "options": [
        {
          "value": "300",
          "label": "Light"
        },
        {
          "value": "400",
          "label": "Normal"
        },
        {
          "value": "500",
          "label": "Medium"
        },
        {
          "value": "600",
          "label": "Semi Bold"
        },
        {
          "value": "700",
          "label": "Bold"
        }
      ]
    },
    {
      "type": "range",
      "id": "center_scale",
      "min": 1.0,
      "max": 1.5,
      "step": 0.1,
      "label": "Center slide scale",
      "default": 1.2
    },
    {
      "type": "header",
      "content": "Slider Settings"
    },
    {
      "type": "checkbox",
      "id": "autoplay",
      "label": "Enable autoplay",
      "default": true
    },
    {
      "type": "range",
      "id": "autoplay_speed",
      "min": 1000,
      "max": 5000,
      "step": 100,
      "unit": "ms",
      "label": "Autoplay speed",
      "default": 2400
    },
    {
      "type": "range",
      "id": "transition_speed",
      "min": 500,
      "max": 3000,
      "step": 100,
      "unit": "ms",
      "label": "Transition speed",
      "default": 1800
    }
  ],
  "blocks": [
    {
      "type": "text_slide",
      "name": "Text Slide",
      "settings": [
        {
          "type": "textarea",
          "id": "heading",
          "label": "Heading text",
          "default": "Your heading text here"
        }
      ]
    },
    {
      "type": "image_slide",
      "name": "Image Slide",
      "settings": [
        {
          "type": "image_picker",
          "id": "image",
          "label": "Slide image"
        },
        {
          "type": "text",
          "id": "heading",
          "label": "Image alt text (optional)",
          "info": "Describe the image for accessibility"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Hero Image Text Slider",
      "blocks": [
        {
          "type": "text_slide",
          "settings": {
            "heading": "A blessing for \n every skin."
          }
        },
        {
          "type": "image_slide"
        },
        {
          "type": "text_slide",
          "settings": {
            "heading": "The perfect mix of \n old & new."
          }
        },
        {
          "type": "image_slide"
        },
        {
          "type": "text_slide",
          "settings": {
            "heading": "A journey over borders \n & generations."
          }
        },
        {
          "type": "image_slide"
        },
        {
          "type": "text_slide",
          "settings": {
            "heading": "You are the \n stylist."
          }
        },
        {
          "type": "image_slide"
        },
        {
          "type": "text_slide",
          "settings": {
            "heading": "To be on the \n forefront."
          }
        },
        {
          "type": "image_slide"
        }
      ]
    }
  ]
}
{% endschema %}