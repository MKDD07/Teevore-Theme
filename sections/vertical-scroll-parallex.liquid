{%- comment -%}
  Creative Showcase Slider Section - Fixed Version with Global Swiper
  Usage: Add this as a section file in sections/creative-slider.liquid
{%- endcomment -%}

{%- liquid
  assign sc = section.settings.slide_count | default: 3
  assign h = section.settings.slide_height | default: '100vh'
  assign brad = section.settings.sbrad | default: 0
  assign loop = section.settings.loop
  assign autoplay = section.settings.enable_autoplay
  assign ad = section.settings.autoplay_delay | default: 5000
  assign fade_effect = section.settings.fade
  assign show_nav = section.settings.show_navigation
  assign show_pag = section.settings.show_pagination
  assign next_txt = section.settings.next_text
  assign prev_txt = section.settings.prev_text

  assign bg_c = section.settings.bg_color | default: '#1a1a1a'
  assign txt_c = section.settings.text_color | default: '#ffffff'
  assign ovl_c = section.settings.overlay_color | default: '#1d1d1d'
  assign light_ovl_c = section.settings.light_overlay_color | default: '#ffffff'
  assign ovl_o = section.settings.overlay_opacity | default: 0.3

  assign t_s = section.settings.title_size | default: '100px'
  assign t_s_t = section.settings.title_size_tablet | default: '72px'
  assign t_s_m = section.settings.title_size_mobile | default: '40px'
  assign t_w = section.settings.title_weight | default: '500'
  assign t_c = section.settings.title_color | default: '#ffffff'
  assign light_t_c = section.settings.light_title_color | default: '#000000'

  assign sub_s = section.settings.subtitle_size | default: '14px'
  assign sub_c = section.settings.subtitle_color | default: '#ffffff'
  assign light_sub_c = section.settings.light_subtitle_color | default: '#000000'

  assign nav_c = section.settings.nav_color | default: '#ffffff'
  assign pag_c = section.settings.pagination_color | default: '#ffffff'
-%}

<section class="cs-s" id="cs-s">
  <div class="bh">
    <slide-section class="ss swiper pr of_hidden ctStyle"
      style="--h: {{ h }}; --brad: {{ brad }}px;"
      data-swiper='{
        "slidesPerView": "1",
        "direction": "vertical",
        "loop": {{ loop }},
        {% if autoplay %}
          "autoplay": { "delay": "{{ ad }}" },
        {% endif %}
        "effect": "{% if fade_effect %}fade{% else %}slide{% endif %}",
        "preloadImages": false,
        "lazy": true,
        "navigation": {
          "nextEl": ".swn{{ section.id }}",
          "prevEl": ".swp{{ section.id }}"
        },
        "pagination": {
          "el": ".swpg{{ section.id }}",
          "clickable": true
        }
      }'>

      <div class="swiper-wrapper">
        {% for block in section.blocks limit: sc %}
          {%- liquid
            assign blk_st = block.settings
            assign video_url = blk_st.slide_video
            assign img_url = blk_st.slide_image
            assign slide_t = blk_st.slide_title
            assign slide_sub = blk_st.slide_subtitle
            assign slide_l = blk_st.slide_link
            assign ovl_s = blk_st.overlay_style | default: 'dark'
            assign bg_pos = blk_st.background_position | default: 'center center'

            assign sub_pos_v = blk_st.subtitle_position_vertical
            assign sub_pos_h = blk_st.subtitle_position_horizontal
            assign sub_off_t = blk_st.subtitle_offset_top
            assign sub_off_b = blk_st.subtitle_offset_bottom
            assign sub_off_l = blk_st.subtitle_offset_left
            assign sub_off_r = blk_st.subtitle_offset_right
          -%}
          <div class="swiper-slide" {{ block.shopify_attributes }}>
            {% if video_url != blank %}
              <div class="sb ovl-{{ ovl_s }}">
                <div class="sc">
                  <div class="sr">
                    <div class="sl-c">
                      {% if slide_sub != blank %}
                        <h6 class="sl-sub">{{ slide_sub }}</h6>
                      {% endif %}
                      {% if slide_t != blank %}
                        <h1 class="sl-h">
                          {% if slide_l != blank %}<a href="{{ slide_l }}">{% endif %}
                          {% assign title_lines = slide_t | split: '|' %}
                          {% for line in title_lines %}
                            <span>{{ line | strip }}</span>
                            {% unless forloop.last %}<br>{% endunless %}
                          {% endfor %}
                          {% if slide_l != blank %}</a>{% endif %}
                        </h1>
                      {% endif %}
                    </div>
                  </div>
                </div>
                <div class="vc">
                  <video autoplay loop muted playsinline><source src="{{ video_url }}" type="video/mp4"></video>
                </div>
              </div>
            {% else %}
              <div class="sb ovl-{{ ovl_s }}"
                   style="background-image: url({{ img_url | img_url: '1920x1080' }}); background-position: {{ bg_pos }};">
                <div class="sc">
                  <div class="sr">
                    <div class="sl-c">
                      {% if slide_sub != blank %}
                        <h6 class="sl-sub vt"
                            style="position: absolute;
                                  {% if sub_pos_v == 'top' %}top: {{ sub_off_t }}px;{% elsif sub_pos_v == 'bottom' %}bottom: {{ sub_off_b }}px;{% endif %}
                                  {% if sub_pos_h == 'left' %}left: {{ sub_off_l }}px;{% elsif sub_pos_h == 'right' %}right: {{ sub_off_r }}px;{% endif %}">
                          {{ slide_sub }}
                        </h6>
                      {% endif %}
                      {% if slide_t != blank %}
                        <h1 class="sl-h">
                          {% if slide_l != blank %}<a href="{{ slide_l }}">{% endif %}
                          {% assign title_lines = slide_t | split: '|' %}
                          {% for line in title_lines %}
                            <span>{{ line | strip }}</span>
                            {% unless forloop.last %}<br>{% endunless %}
                          {% endfor %}
                          {% if slide_l != blank %}</a>{% endif %}
                        </h1>
                      {% endif %}
                    </div>
                  </div>
                </div>
              </div>
            {% endif %}
          </div>
        {% endfor %}
      </div>

      {% if show_nav %}
        <div class="sw-b-w" style="border-top:1px solid {{ nav_c }};">
          <div class="sw-bn swn{{ section.id }}" tabindex="0" role="button" aria-label="Next slide">
            <span>{{ next_txt }}</span>
          </div>
          {% if show_pag %}
            <div class="sw-pg swpg{{ section.id }}"></div>
          {% endif %}
          <div class="sw-bp swp{{ section.id }}" tabindex="0" role="button" aria-label="Previous slide">
            <div>
              <span>{{ prev_txt }}</span>
            </div>
          </div>
        </div>
      {% endif %}
    </slide-section>
  </div>
</section>

<style>
  #cs-s {
    color: {{ txt_c }};
    background-color: {{ bg_c }};
    overflow: hidden;
  }

  #cs-s .ss {
    width: 100%;
    height: var(--h);
    max-height: var(--h);
    border-radius: var(--brad);
  }

  #cs-s .swiper-slide {
    position: relative;
    overflow: hidden;
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  #cs-s .swiper-slide .sb {
    position: absolute;
    top: 0;
    right: 0;
    bottom: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-size: cover;
    background-repeat: no-repeat;
    background-position: center center;
    background-attachment: fixed;
  }

  #cs-s .swiper-slide .ovl-dark:before {
    opacity: {{ ovl_o }};
    background: {{ ovl_c }};
    content: '';
    position: absolute;
    width: 100%;
    height: 100%;
    top: 0;
    left: 0;
    z-index: 1;
    pointer-events: none;
  }

  .vt {
    writing-mode: vertical-rl;
    transform: rotate(180deg);
    white-space: nowrap;
  }

  #cs-s .swiper-slide .ovl-light:before {
    opacity: {{ ovl_o }};
    background: {{ light_ovl_c }};
    content: '';
    position: absolute;
    width: 100%;
    height: 100%;
    top: 0;
    left: 0;
    z-index: 1;
    pointer-events: none;
  }

  #cs-s .swiper-slide .vc {
    position: absolute;
    top: 0;
    right: 0;
    bottom: 0;
    left: 0;
    width: 100%;
    height: 100%;
  }

  #cs-s .swiper-slide .vc video {
    width: 100%;
    height: 100%;
    object-fit: cover;
    object-position: center center;
  }

  #cs-s .swiper-slide .sb .sc {
    max-width: 1320px;
    width: 100%;
    margin: 0 auto;
    position: relative;
    z-index: 7;
    padding: 0 15px;
    height: 100%;
    display: flex;
    align-items: center;
  }

  #cs-s .sb .sc .sr {
    display: flex;
    flex-wrap: wrap;
    width: 100%;
  }

  #cs-s .sc .sr .sl-c {
    flex: 0 0 auto;
    width: 91.66666667%;
    margin-left: 2%;
    padding: 0 15px;
  }

  #cs-s .sl-c .sl-sub {
    font-size: {{ sub_s }};
    text-transform: uppercase;
    letter-spacing: 2px;
    color: {{ sub_c }};
    font-weight: 500;
    line-height: 1.3;
    margin: 0 0 30px 0;
  }

  #cs-s .sl-c .sl-h {
    font-size: {{ t_s }};
    color: {{ t_c }};
    margin: 0;
    font-weight: {{ t_w }};
    line-height: 1.2;
    transform: translateY(-400px);
    opacity: 0;
    animation: slideUpIn 0.8s ease-out 0.3s forwards;
  }

  @keyframes slideUpIn {
    to {
      transform: translateY(0);
      opacity: 1;
    }
  }

  #cs-s .sl-c .sl-h span {
    display: inline-block;
  }

  #cs-s .sl-c .sl-h a {
    text-decoration: none;
    color: inherit;
    outline: none;
  }

  #cs-s .ovl-light .sl-c .sl-h,
  #cs-s .ovl-light .sl-c .sl-h a {
    color: {{ light_t_c }};
  }

  #cs-s .ovl-light .sl-c .sl-sub {
    color: {{ light_sub_c }};
  }

  #cs-s .sw-b-w .sw-bp,
  #cs-s .sw-b-w .sw-bn {
    position: absolute;
    display: flex;
    align-items: center;
    top: auto;
    color: {{ nav_c }};
    z-index: 9;
    cursor: pointer;
    width: auto;
    bottom: 30px;
    font-weight: 300;
    font-size: 16px;
    letter-spacing: 0.5px;
    line-height: normal;
  }

  #cs-s .sw-b-w .sw-bn {
    right: 120px;
  }

  #cs-s .sw-b-w {
    position: absolute;
    width: 100%;
    bottom: 0;
    z-index: 10;
  }

  #cs-s .sw-b-w .sw-bp {
    left: 120px;
  }

  #cs-s .sw-b-w .sw-bn:after,
  #cs-s .sw-b-w .sw-bp:after {
    display: none;
  }

  #cs-s .bh .sw-pg {
    bottom: 30px;
    width: 100%;
    text-align: center;
    position: absolute;
    z-index: 10;
  }

  #cs-s .bh .swiper-pagination-bullet {
    background: {{ pag_c }};
    margin: 0 5px;
    opacity: 0.5;
    width: 12px;
    height: 12px;
    border-radius: 50%;
  }

  #cs-s .bh .swiper-pagination-bullet-active {
    opacity: 1;
  }

  /* Responsive Styles */
  @media (max-width: 991px) {
    #cs-s .sc .sr .sl-c {
      flex: 0 0 auto;
      width: 100%;
      margin-left: 0;
    }

    #cs-s .sl-c .sl-h {
      font-size: {{ t_s_t }};
    }

    #cs-s .bh .sw-pg {
      display: none;
    }

    #cs-s .sw-b-w .sw-bp {
      left: 15px;
    }

    #cs-s .sw-b-w .sw-bn {
      right: 15px;
    }
  }

  @media screen and (max-width: 767px) {
    #cs-s .sc .sr .sl-c {
      padding: 0;
    }

    #cs-s .sl-c .sl-h {
      font-size: {{ t_s_m }};
    }

    #cs-s .sl-c .sl-sub {
      margin-bottom: 15px;
    }

    #cs-s .swiper-slide .sb {
      background-attachment: scroll;
    }
  }
</style>

{% schema %}
{
  "name": "Creative Slider",
  "class": "creative-slider-section",
  "settings": [
    {
      "type": "range",
      "id": "slide_count",
      "min": 1,
      "max": 10,
      "step": 1,
      "label": "Maximum slides to show",
      "default": 5
    },
    {
      "type": "text",
      "id": "slide_height",
      "label": "Slide Height",
      "default": "100vh",
      "info": "Use CSS units like 100vh, 600px, etc."
    },
    {
      "type": "range",
      "id": "sbrad",
      "min": 0,
      "max": 50,
      "step": 1,
      "label": "Border Radius",
      "default": 0
    },
    {
      "type": "header",
      "content": "Colors"
    },
    {
      "type": "color",
      "id": "bg_color",
      "label": "Background Color",
      "default": "#1a1a1a"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Text Color",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "overlay_color",
      "label": "Dark Overlay Color",
      "default": "#1d1d1d"
    },
    {
      "type": "color",
      "id": "light_overlay_color",
      "label": "Light Overlay Color",
      "default": "#ffffff"
    },
    {
      "type": "range",
      "id": "overlay_opacity",
      "min": 0,
      "max": 1,
      "step": 0.1,
      "label": "Overlay Opacity",
      "default": 0.3
    },
    {
      "type": "header",
      "content": "Typography"
    },
    {
      "type": "text",
      "id": "title_size",
      "label": "Title Size (Desktop)",
      "default": "100px"
    },
    {
      "type": "text",
      "id": "title_size_tablet",
      "label": "Title Size (Tablet)",
      "default": "72px"
    },
    {
      "type": "text",
      "id": "title_size_mobile",
      "label": "Title Size (Mobile)",
      "default": "40px"
    },
    {
      "type": "select",
      "id": "title_weight",
      "label": "Title Font Weight",
      "options": [
        {"value": "300", "label": "Light"},
        {"value": "400", "label": "Normal"},
        {"value": "500", "label": "Medium"},
        {"value": "600", "label": "Semi Bold"},
        {"value": "700", "label": "Bold"}
      ],
      "default": "500"
    },
    {
      "type": "color",
      "id": "title_color",
      "label": "Title Color (Dark Overlay)",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "light_title_color",
      "label": "Title Color (Light Overlay)",
      "default": "#000000"
    },
    {
      "type": "text",
      "id": "subtitle_size",
      "label": "Subtitle Size",
      "default": "14px"
    },
    {
      "type": "color",
      "id": "subtitle_color",
      "label": "Subtitle Color (Dark Overlay)",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "light_subtitle_color",
      "label": "Subtitle Color (Light Overlay)",
      "default": "#000000"
    },
    {
      "type": "header",
      "content": "Navigation"
    },
    {
      "type": "checkbox",
      "id": "show_navigation",
      "label": "Show Navigation Arrows",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_pagination",
      "label": "Show Pagination Dots",
      "default": true
    },
    {
      "type": "textarea",
      "id": "next_text",
      "label": "Next Button Text",
      "default": "Next Slide"
    },
    {
      "type": "textarea",
      "id": "prev_text",
      "label": "Previous Button Text",
      "default": "Prev Slide"
    },
    {
      "type": "color",
      "id": "nav_color",
      "label": "Navigation Color",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "pagination_color",
      "label": "Pagination Color",
      "default": "#ffffff"
    },
    {
      "type": "header",
      "content": "Slider Settings"
    },
    {
      "type": "checkbox",
      "id": "enable_autoplay",
      "label": "Enable Autoplay",
      "default": true
    },
    {
      "type": "range",
      "id": "autoplay_delay",
      "min": 2000,
      "max": 9000,
      "step": 500,
      "label": "Autoplay Delay (ms)",
      "default": 5000
    },
    {
      "type": "checkbox",
      "id": "loop",
      "label": "Enable Loop",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "fade",
      "label": "Enable Fade Effect",
      "default": false
    }
  ],
  "blocks": [
    {
      "type": "slide",
      "name": "Slide",
      "settings": [
        {
          "type": "image_picker",
          "id": "slide_image",
          "label": "Slide Background Image"
        },
        {
          "type": "url",
          "id": "slide_video",
          "label": "Slide Video URL (MP4)",
          "info": "If video is provided, it will be used instead of image"
        },
        {
          "type": "text",
          "id": "slide_title",
          "label": "Slide Title",
          "info": "Use | to separate title lines"
        },
        {
          "type": "text",
          "id": "slide_subtitle",
          "label": "Slide Subtitle"
        },
        {
          "type": "url",
          "id": "slide_link",
          "label": "Slide Link"
        },
        {
          "type": "select",
          "id": "overlay_style",
          "label": "Overlay Style",
          "options": [
            {"value": "dark", "label": "Dark"},
            {"value": "light", "label": "Light"}
          ],
          "default": "dark"
        },
        {
          "type": "select",
          "id": "background_position",
          "label": "Background Position",
          "options": [
            {"value": "center center", "label": "Center Center"},
            {"value": "center top", "label": "Center Top"},
            {"value": "center bottom", "label": "Center Bottom"},
            {"value": "left center", "label": "Left Center"},
            {"value": "right center", "label": "Right Center"}
          ],
          "default": "center center"
        },
        {
          "type": "select",
          "id": "subtitle_position_horizontal",
          "label": "Subtitle Horizontal Position",
          "default": "left",
          "options": [
            {"value": "left", "label": "Left"},
            {"value": "right", "label": "Right"}
          ]
        },
        {
          "type": "select",
          "id": "subtitle_position_vertical",
          "label": "Subtitle Vertical Position",
          "default": "top",
          "options": [
            {"value": "top", "label": "Top"},
            {"value": "bottom", "label": "Bottom"}
          ]
        },
        {
          "type": "range",
          "id": "subtitle_offset_top",
          "label": "Top Offset (px)",
          "min": 0,
          "max": 500,
          "step": 5,
          "default": 10
        },
        {
          "type": "range",
          "id": "subtitle_offset_bottom",
          "label": "Bottom Offset (px)",
          "min": 0,
          "max": 500,
          "step": 5,
          "default": 10
        },
        {
          "type": "range",
          "id": "subtitle_offset_left",
          "label": "Left Offset (px)",
          "min": 0,
          "max": 500,
          "step": 5,
          "default": 10
        },
        {
          "type": "range",
          "id": "subtitle_offset_right",
          "label": "Right Offset (px)",
          "min": 0,
          "max": 500,
          "step": 5,
          "default": 10
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Creative Slider",
      "blocks": [
        {
          "type": "slide",
          "settings": {
            "slide_title": "Creative|Portfolio",
            "slide_subtitle": "© Your Brand",
            "overlay_style": "dark"
          }
        },
        {
          "type": "slide",
          "settings": {
            "slide_title": "Amazing|Designs",
            "slide_subtitle": "© Your Brand",
            "overlay_style": "dark"
          }
        },
        {
          "type": "slide",
          "settings": {
            "slide_title": "Beautiful|Projects",
            "slide_subtitle": "© Your Brand",
            "overlay_style": "light"
          }
        }
      ]
    }
  ]
}
{% endschema %}